# SedAirCheck ソフトウェア要求仕様書
## 医療機器プロトタイプ - 内視鏡検査における静脈麻酔リスク評価システム

### 文書情報
- **プロジェクト名**: SedAirCheck
- **バージョン**: 1.0
- **作成日**: 2025-06-20
- **ステータス**: プロトタイプ仕様

---

## 1. 概要

### 1.1 製品概要
SedAirCheckは、消化管内視鏡検査における静脈麻酔のリスク評価を支援するWebアプリケーションです。iPhoneで撮影した口腔内写真からマランパティ分類を自動判定し、麻酔科専門医の同席や全身麻酔への変更が必要な高リスク患者を特定します。

### 1.2 医学的背景
- **マランパティ分類**: 気道評価のための標準的分類システム（Class I-IV）
- **リスク閾値**: Class III/IVが高リスクと定義
- **臨床的意義**: 高リスク患者の早期特定により合併症を予防

### 1.3 対象ユーザー
- **一次ユーザー**: 消化器内科医
- **使用環境**: クリニック、病院の外来
- **使用目的**: プロトタイプの使用感評価

---

## 2. 機能要件

### 2.1 コア機能

#### 2.1.1 画像アップロード機能
- **入力**: iPhone撮影の口腔内写真（JPEG, PNG）
- **制約**: 最大ファイルサイズ 10MB
- **前処理**: 画像品質チェック、リサイズ

#### 2.1.2 マランパティ分類判定機能
- **入力**: 口腔内写真
- **処理**: Gemini Pro Vision APIによる画像解析
- **出力**: マランパティ分類（Class I-IV）、信頼度スコア

#### 2.1.3 リスク評価機能
- **判定基準**:
  - **低リスク**: Class I, II
  - **高リスク**: Class III, IV
- **出力**: 2段階のリスク評価結果

#### 2.1.4 結果表示機能
- **表示内容**:
  - リスク評価結果（高リスク/低リスク）
  - マランパティ分類
  - 推奨される対応
  - 信頼度スコア

### 2.2 補助機能

#### 2.2.1 撮影ガイド機能
- 適切な撮影方法の説明
- 画像品質要件の提示

#### 2.2.2 履歴機能
- 評価結果の一時保存
- セッション内での履歴表示

---

## 3. 非機能要件

### 3.1 性能要件
- **処理時間**: 画像アップロードから結果表示まで30秒以内
- **可用性**: 営業時間内95%以上
- **同時ユーザー**: 10名まで対応

### 3.2 セキュリティ要件
- **データ保護**: 画像データの一時的保存のみ
- **通信暗号化**: HTTPS通信
- **データ削除**: セッション終了時に自動削除

### 3.3 互換性要件
- **ブラウザ対応**: Chrome, Safari, Firefox (最新版)
- **デバイス対応**: PC, タブレット
- **画像形式**: JPEG, PNG

### 3.4 ユーザビリティ要件
- **操作性**: 3クリック以内で結果表示
- **レスポンシブ**: モバイル・デスクトップ対応
- **アクセシビリティ**: 医療従事者向けUI

---

## 4. システム仕様

### 4.1 システム構成

#### 4.1.1 フロントエンド
- **技術**: React 18, TypeScript, Tailwind CSS
- **機能**: 
  - ファイルアップロード
  - 結果表示UI
  - レスポンシブデザイン

#### 4.1.2 バックエンド
- **技術**: Node.js 18, Express, TypeScript
- **機能**:
  - 画像処理API
  - Gemini API連携
  - リスク判定ロジック

#### 4.1.3 画像認識エンジン
- **API**: Google Gemini Pro Vision
- **機能**:
  - 口腔内構造認識
  - マランパティ分類判定
  - 信頼度スコア算出

### 4.2 データフロー

```
1. ユーザー画像アップロード
2. バックエンド: 画像前処理
3. Gemini API: 画像解析・分類
4. バックエンド: リスク判定
5. フロントエンド: 結果表示
6. データ削除: セッション終了時
```

### 4.3 API仕様

#### 4.3.1 画像解析API
```
POST /api/analyze
Content-Type: multipart/form-data
Body: image (file)
Response: {
  mallampatiClass: 1-4,
  riskLevel: "low" | "high",
  confidence: 0.0-1.0,
  recommendation: string
}
```

---

## 5. AI モデル仕様

### 5.1 Gemini Pro Vision 設定

#### 5.1.1 プロンプト設計
```
医療画像解析: マランパティ分類
入力: 口腔内写真
タスク: 以下の構造の可視性を評価
- 軟口蓋
- 口蓋垂
- 扁桃柱
- 硬口蓋

分類基準:
Class I: すべての構造が明確に見える
Class II: 軟口蓋、口蓋垂、扁桃柱の上部が見える
Class III: 軟口蓋、口蓋垂の一部のみ見える
Class IV: 硬口蓋のみ見える

出力: JSON形式で分類と信頼度
```

### 5.2 精度要件
- **目標精度**: 80%以上（二分類）
- **信頼度閾値**: 0.7以上で判定有効
- **エラーハンドリング**: 低信頼度時の警告表示

---

## 6. ユーザーインターフェース

### 6.1 画面構成

#### 6.1.1 メイン画面
- **ヘッダー**: アプリケーション名、バージョン
- **アップロード領域**: ドラッグ&ドロップ対応
- **撮影ガイド**: 適切な撮影方法の説明
- **結果表示領域**: 判定結果、推奨事項

#### 6.1.2 結果画面
- **リスク表示**: 視覚的なリスクレベル表示
- **詳細情報**: マランパティ分類、信頼度
- **推奨事項**: 臨床対応の提案
- **新規解析ボタン**: 次の解析への遷移

### 6.2 ワークフロー

```
1. 画像選択・アップロード
2. 解析中表示（プログレスバー）
3. 結果表示
   - 高リスク: 麻酔科医同席推奨
   - 低リスク: 通常の静脈麻酔可能
4. 新規解析または終了
```

---

## 7. 品質要件

### 7.1 テスト要件
- **単体テスト**: カバレッジ80%以上
- **統合テスト**: API連携テスト
- **ユーザビリティテスト**: 医師による使用性評価

### 7.2 臨床精度検証
- **検証対象**: 50症例以上
- **基準**: 専門医による手動分類との一致率
- **目標**: Kappa係数 0.6以上

---

## 8. リスク管理

### 8.1 技術的リスク
- **API制限**: Gemini API の利用制限
- **画像品質**: 不適切な撮影による誤判定
- **ネットワーク**: 通信エラーによる処理失敗

### 8.2 臨床的リスク
- **偽陰性**: 高リスク患者の見逃し
- **偽陽性**: 不要な専門医依頼
- **過信**: AI判定への過度な依存

### 8.3 対策
- **多重チェック**: 信頼度スコアによる警告
- **教育**: 適切な使用方法の説明
- **免責**: プロトタイプとしての位置づけ明示

---

## 9. 開発計画

### 9.1 開発フェーズ

#### Phase 1: 基盤構築 (1週間)
- プロジェクト設定
- 基本UI実装
- Gemini API連携

#### Phase 2: コア機能実装 (1週間)
- 画像アップロード機能
- 判定ロジック実装
- 結果表示機能

#### Phase 3: 検証・改善 (1週間)
- 精度検証
- UI/UX改善
- エラーハンドリング

### 9.2 成果物
- **動作するWebアプリケーション**
- **ソースコード**
- **使用方法ドキュメント**
- **検証結果レポート**

---

## 10. 制限事項

### 10.1 プロトタイプとしての制限
- **規制対応**: ISO 13485, IEC 62304非対応
- **臨床使用**: 実臨床での診断使用不可
- **データ保存**: 長期保存機能なし

### 10.2 技術的制限
- **オフライン**: インターネット接続必須
- **画像サイズ**: 大容量画像の処理制限
- **同時処理**: 多数の同時アクセス制限

---

## 11. 将来の拡張性

### 11.1 機能拡張
- **他のリスク因子**: ASA分類、BMI等の追加
- **詳細分析**: 解剖学的構造の詳細測定
- **データ蓄積**: 症例データベースの構築

### 11.2 技術拡張
- **モバイルアプリ**: iOSネイティブアプリ化
- **エッジAI**: ローカル推論モデルの実装
- **カスタムモデル**: 専用学習モデルの開発

---

## 付録

### A. 参考文献
- Mallampati et al. (1985) Clinical sign to predict difficult tracheal intubation
- 日本消化器内視鏡学会 鎮静に関するガイドライン
- European Society of Anaesthesiology guidelines

### B. 用語集
- **マランパティ分類**: Mallampati Classification
- **静脈麻酔**: Intravenous Sedation
- **ASA**: American Society of Anesthesiologists

### C. 承認
- **作成者**: AI開発チーム
- **レビュー**: 消化器内科医
- **承認日**: 2025-06-20